
ENABLE=$(grep "^enabled=" /opt/etc/config/wifi | cut -d = -f 2)
DRIVER=$(grep "^driver=" /opt/etc/config/wifi | cut -d = -f 2)

start() {
    if [ $ENABLE -eq 1 ] ; then
	if [ -e /opt/share/wifi/driver-$DRIVER ] ; then
	    /usr/share/snake/network stop
	    sh /opt/share/wifi/driver-$DRIVER up
	else
	    echo "invalid driver"
	    return
	fi
	
	# wait about 10 seconds for the interface to come up
	i=0
	while [ $i -lt 10 ] ; do
	    if [ ! -z "$(/sbin/ifconfig | cut -d ' ' -f 1 | grep -v '^$\|lo')" ] ; then
		return
	    fi
	    i=$((i+1));
	    sleep 1
	done

	# restore wired network if the interface is still not up
	sh /opt/share/wifi/driver-$DRIVER down
	/usr/share/snake/network start
    fi
}

stop() {
    if [ -e /opt/share/wifi/driver-$DRIVER ] ; then
	sh /opt/share/wifi/driver-$DRIVER down
    fi
    /usr/share/snake/network start
}

case "$1" in
    start)
  	start
	;;
    stop)
  	stop
	;;
    *)
	echo "Usage: $0 {start|stop}"
	exit 1
esac


